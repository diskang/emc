import numpy as np
from toaccount import account_name
from datetime import datetime
from datetime import timedelta
from copy import deepcopy
# dining hall 2
idletimes = {'06:25:00':14.52385556,'06:30:00':13.2348482,'06:35:00':13.11617758,'06:40:00':15.75308804,'06:45:00':15.39610671,'06:50:00':14.75336785,'06:55:00':13.41202962,'07:00:00':14.8827036,'07:05:00':12.84160768,'07:10:00':13.45045309,'07:15:00':13.81037655,'07:20:00':12.55372291,'07:25:00':11.22162588,'07:30:00':10.29376816,'07:35:00':8.960539444,'07:40:00':10.06732581,'07:45:00':17.36553195,'07:50:00':14.46331546,'07:55:00':16.45014161,'08:00:00':12.38407807,'08:05:00':14.18643873,'08:10:00':13.14269337,'08:15:00':13.9773681,'08:20:00':14.3912916,'08:25:00':12.78243291,'08:30:00':13.17220972,'08:35:00':11.24146695,'08:40:00':14.12336606,'08:45:00':14.07772876,'08:50:00':16.30757771,'08:55:00':14.48044005,'09:00:00':15.79907694,'09:05:00':12.88730548,'09:10:00':11.76372731,'09:15:00':9.629781857,'09:20:00':10.02699855,'09:25:00':13.9738651,'09:30:00':9.952748893,'09:35:00':10.60820121,'09:40:00':11.17444167,'09:45:00':17.11455208,'09:50:00':21.02040926,'09:55:00':21.78267,'10:15:00':28.89024583,'10:35:00':22.94623,'10:45:00':23.03564829,'10:50:00':21.711176,'10:55:00':17.2527618,'11:00:00':15.14829893,'11:05:00':11.87751743,'11:10:00':15.28399125,'11:15:00':18.26599437,'11:20:00':16.93447808,'11:25:00':17.78356043,'11:30:00':16.63323692,'11:35:00':17.37229322,'11:40:00':18.55944699,'11:45:00':17.86885427,'11:50:00':18.05614941,'11:55:00':16.32889902,'12:00:00':17.51815088,'12:05:00':15.59254568,'12:10:00':17.21143204,'12:15:00':19.7309499,'12:20:00':14.80629265,'12:25:00':14.59688477,'12:30:00':18.3576272,'12:35:00':20.51292244,'12:45:00':21.59968952,'15:55:00':21.99589327,'16:05:00':19.73977344,'16:35:00':21.36351329,'16:40:00':18.32157171,'16:45:00':20.88460444,'16:50:00':19.58991035,'16:55:00':17.19833946,'17:00:00':16.2820983,'17:05:00':18.49260851,'17:10:00':17.59842739,'17:15:00':15.97999018,'17:20:00':14.28379149,'17:25:00':14.33806834,'17:30:00':16.55928703,'17:35:00':16.97831864,'17:40:00':21.60505121,'17:45:00':20.19648649,'17:50:00':18.60459591,'17:55:00':17.7362773,'18:00:00':17.61334082,'18:05:00':17.36147802,'18:10:00':14.66510716,'18:15:00':15.11502538,'18:20:00':15.04226516,'18:25:00':14.16592847,'18:30:00':11,'18:35:00':10}	
visit = [{},{},{},{},{},{},{}]
visit[1] = {'05:30:00':0.06054862,'05:40:00':2.780315277,'05:50:00':10.11213347,'06:00:00':17.10263589,'06:10:00':23.8718966,'06:20:00':37.10197622,'06:30:00':40.79230519,'06:40:00':66.83967715,'06:50:00':73.63622245,'07:00:00':104.7377031,'07:10:00':167.6762039,'07:20:00':272.354513,'07:30:00':348.2221499,'07:40:00':244.2793788,'07:50:00':123.619132,'08:00:00':114.6308923,'08:10:00':119.3804971,'08:20:00':130.4459555,'08:30:00':140.4185828,'08:40:00':122.85548,'08:50:00':114.8599819,'09:00:00':103.7074123,'09:10:00':103.251513,'09:20:00':114.6904004,'09:30:00':140.7567108,'09:40:00':80.92064485,'09:50:00':32.49906283,'10:00:00':18.89527462,'10:10:00':26.46248688,'10:20:00':22.38487808,'10:30:00':34.14701471,'10:40:00':49.93487758,'10:50:00':92.59340635,'11:00:00':154.1060028,'11:10:00':213.9739891,'11:20:00':310.9192111,'11:30:00':498.0418063,'11:40:00':381.8636919,'11:50:00':170.4113978,'12:00:00':117.9391827,'12:10:00':82.53314494,'12:20:00':58.5592614,'12:30:00':36.01400265,'12:40:00':17.83478343,'12:50:00':6.336151698,'13:00:00':1.878548407,'13:10:00':0.648885597,'13:20:00':0.139720224,'13:30:00':0.144748201,'13:40:00':0.0282494,'13:50:00':0.021582734,'14:00:00':3.073583892,'14:10:00':1.5,'14:20:00':0.007194245,'14:30:00':0,'14:40:00':0,'14:50:00':1.682335106,'15:00:00':0,'15:10:00':0.014228255,'15:20:00':0.142679087,'15:30:00':0.992782465,'15:40:00':2.277190645,'15:50:00':6.449741845,'16:00:00':9.958231919,'16:10:00':18.9552618,'16:20:00':33.44325606,'16:30:00':50.56968596,'16:40:00':82.27722937,'16:50:00':153.2944405,'17:00:00':242.805905,'17:10:00':300.8951422,'17:20:00':360.979697,'17:30:00':348.9748914,'17:40:00':211.9314794,'17:50:00':144.0697121,'18:00:00':106.5001123,'18:10:00':58.06155186,'18:20:00':33.06556525,'18:30:00':19.21831386,'18:40:00':8.395377905,'18:50:00':1.457977687,'19:00:00':0.0877498,'19:10:00':0.013333333,'19:20:00':0}
visit[2] = {'05:30:00':10.39033326,'05:40:00':32.07840317,'05:50:00':48.47223127,'06:00:00':43.54802009,'06:10:00':58.0617552,'06:20:00':89.76086445,'06:30:00':68.09765644,'06:40:00':72.28078714,'06:50:00':88.57044555,'07:00:00':119.7899268,'07:10:00':198.1024992,'07:20:00':336.4690229,'07:30:00':469.7840588,'07:40:00':383.605262,'07:50:00':196.0122515,'08:00:00':197.9410551,'08:10:00':217.7176788,'08:20:00':231.7609949,'08:30:00':266.4601067,'08:40:00':230.2106438,'08:50:00':186.8798039,'09:00:00':183.727449,'09:10:00':181.0083014,'09:20:00':199.5037483,'09:30:00':230.0086328,'09:40:00':154.1599636,'09:50:00':74.97358987,'10:00:00':47.05709863,'10:10:00':49.33905833,'10:20:00':58.86497692,'10:30:00':67.15149016,'10:40:00':112.4016843,'10:50:00':205.089815,'11:00:00':386.4478902,'11:10:00':565.3865885,'11:20:00':711.5629508,'11:30:00':865.2138389,'11:40:00':742.9281806,'11:50:00':466.4375267,'12:00:00':359.2147789,'12:10:00':265.9276835,'12:20:00':200.9734554,'12:30:00':147.3071934,'12:40:00':72.30477883,'12:50:00':40.05571906,'13:00:00':19.99188095,'13:10:00':13.67867909,'13:20:00':14.36144893,'13:30:00':14.32939097,'13:40:00':13.18133714,'13:50:00':10.83401321,'14:00:00':9.946415709,'14:10:00':9.93134272,'14:20:00':11.42770402,'14:30:00':11.94258728,'14:40:00':11.07388349,'14:50:00':10.88240056,'15:00:00':11.0158892,'15:10:00':12.0635584,'15:20:00':15.20202013,'15:30:00':21.85391779,'15:40:00':18.05694934,'15:50:00':14.71060854,'16:00:00':22.2846735,'16:10:00':35.07086031,'16:20:00':72.05765849,'16:30:00':124.6364478,'16:40:00':200.4575288,'16:50:00':353.2452553,'17:00:00':573.4493635,'17:10:00':708.6589246,'17:20:00':738.2888647,'17:30:00':689.4235557,'17:40:00':485.8400959,'17:50:00':349.2812409,'18:00:00':263.719292,'18:10:00':162.7761505,'18:20:00':101.916445,'18:30:00':70.73485903,'18:40:00':37.56379919,'18:50:00':25.3003625,'19:00:00':18.98989224,'19:10:00':15.16124357,'19:20:00':15.07884578,'19:30:00':14.86419948,'19:40:00':15.31886739,'19:50:00':17.04609929,'20:00:00':19.16759969,'20:10:00':20.67080378,'20:20:00':20.52359003,'20:30:00':18.27171986,'20:40:00':18.74261229,'20:50:00':18.30865839,'21:00:00':19.16016548,'21:10:00':18.55112293,'21:20:00':19.47399527,'21:30:00':21.32993499,'21:40:00':24.78516548,'21:50:00':32.40292553,'22:00:00':22.375,'22:10:00':10.41671523,'22:20:00':0.006944444,'22:30:00':0.007092199}
visit[3] = {'05:30:00':0,'05:40:00':0,'05:50:00':0,'06:00:00':0.069444444,'06:10:00':2.722222222,'06:20:00':14.7662037,'06:30:00':24.48611111,'06:40:00':39.94722222,'06:50:00':65.08240741,'07:00:00':96.14537037,'07:10:00':135.0884259,'07:20:00':167.9435185,'07:30:00':162.3972222,'07:40:00':113.9384259,'07:50:00':104.3074074,'08:00:00':121.7388889,'08:10:00':133.8333333,'08:20:00':134.949537,'08:30:00':137.1518519,'08:40:00':112.237037,'08:50:00':104.4518519,'09:00:00':83.16342593,'09:10:00':60.92053872,'09:20:00':43.82655724,'09:30:00':29.60883838,'09:40:00':13.90631313,'09:50:00':5.918855219,'10:00:00':5.008585859,'10:10:00':12.9148569,'10:20:00':11.46965488,'10:30:00':20.78030303,'10:40:00':42.63935185,'10:50:00':88.53354377,'11:00:00':158.9373316,'11:10:00':242.5743687,'11:20:00':316.2881313,'11:30:00':388.3595539,'11:40:00':442.1849327,'11:50:00':293.2784512,'12:00:00':202.7167088,'12:10:00':136.9834175,'12:20:00':88.64103535,'12:30:00':56.30677609,'12:40:00':26.10223064,'12:50:00':10.33754209,'13:00:00':3.215572391,'13:10:00':0.943181818,'13:20:00':0.34469697,'13:30:00':0.188762626,'13:40:00':0.055555556,'13:50:00':0.027777778,'14:00:00':0.027777778,'14:10:00':0,'14:20:00':0.041666667,'14:30:00':0.027777778,'14:40:00':0,'14:50:00':0,'15:00:00':0.006944444,'15:10:00':0.007575758,'15:20:00':0.014520202,'15:30:00':0.10290404,'15:40:00':1.078872054,'15:50:00':2.538089226,'16:00:00':6.722053872,'16:10:00':16.18497475,'16:20:00':31.59570707,'16:30:00':53.74806397,'16:40:00':87.5030303,'16:50:00':163.9133838,'17:00:00':252.3276094,'17:10:00':315.234596,'17:20:00':321.8813131,'17:30:00':305.0853956,'17:40:00':255.3248737,'17:50:00':181.8136364,'18:00:00':120.7048401,'18:10:00':74.56502525,'18:20:00':46.06632997,'18:30:00':24.43821549,'18:40:00':10.72356902,'18:50:00':3.878156566,'19:00:00':0.894570707,'19:10:00':0.303030303,'19:20:00':0.077020202,'19:30:00':0.035353535,'19:40:00':0.035353535,'19:50:00':0,'20:00:00':0.006944444,'20:10:00':0.027777778,'20:20:00':0.013888889,'20:30:00':0,'20:40:00':0,'20:50:00':0,'21:00:00':0,'21:10:00':0,'21:20:00':0,'21:30:00':0,'21:40:00':0,'21:50:00':2.951136364,'22:00:00':9.366245791}
visit[4] = {'05:30:00':0.032679739,'05:40:00':0.176470588,'05:50:00':0.464052288,'06:00:00':1.725490196,'06:10:00':3.522875817,'06:20:00':5.29438442,'06:30:00':9.39869281,'06:40:00':10.87581699,'06:50:00':15.22222222,'07:00:00':21.89542484,'07:10:00':31.82352941,'07:20:00':48.91636567,'07:30:00':62.53035776,'07:40:00':65.76470588,'07:50:00':79.28104575,'08:00:00':92.0130719,'08:10:00':103.5751634,'08:20:00':105.5620915,'08:30:00':109.5229624,'08:40:00':93.52941176,'08:50:00':83.55956053,'09:00:00':66.22875817,'09:10:00':53.00093646,'09:20:00':40.14387308,'09:30:00':16.63241654,'09:40:00':8.744867522,'09:50:00':4.167223496,'10:00:00':3.308784763,'10:10:00':10.63281138,'10:20:00':10.3649424,'10:30:00':23.59410286,'10:40:00':58.54804712,'10:50:00':135.0102558,'11:00:00':260.6501093,'11:10:00':344.6462393,'11:20:00':390.6262666,'11:30:00':382.2147255,'11:40:00':378.1545164,'11:50:00':278.9541817,'12:00:00':197.0439143,'12:10:00':126.9299661,'12:20:00':73.79208981,'12:30:00':43.45764481,'12:40:00':21.46177057,'12:50:00':9.224536124,'13:00:00':3.526586197,'13:10:00':0.951565714,'13:20:00':0.301479364,'13:30:00':0.176685587,'13:40:00':0.130804954,'13:50:00':0.08501032,'14:00:00':0.058910098,'14:10:00':0.045838203,'14:20:00':0.065359477,'14:30:00':0.058823529,'14:40:00':0.032679739,'14:50:00':0.032679739,'15:00:00':0.039215686,'15:10:00':0.039979009,'15:20:00':0.026143791,'15:30:00':0.026907113,'15:40:00':1.818196697,'15:50:00':0.157381589,'16:00:00':2.347603999,'16:10:00':3.347922945,'16:20:00':14.85456156,'16:30:00':33.8939424,'16:40:00':76.86996221,'16:50:00':151.4319076,'17:00:00':265.2484219,'17:10:00':313.1462766,'17:20:00':303.3106314,'17:30:00':263.9636214,'17:40:00':222.4174278,'17:50:00':168.3007866,'18:00:00':121.3609582,'18:10:00':75.66980621,'18:20:00':40.6358488,'18:30:00':23.59459999,'18:40:00':10.96534869,'18:50:00':2.833106927,'19:00:00':0.446371531,'19:10:00':0.156948744,'19:20:00':0.137254902,'19:30:00':1.449646525,'19:40:00':0.039215686,'19:50:00':0.130718954,'20:00:00':0.150326797,'20:10:00':0.098039216,'20:20:00':0.052287582,'20:30:00':0.065359477,'20:40:00':0.052287582,'20:50:00':0.065359477,'21:00:00':0.026143791,'21:10:00':0.032679739,'21:20:00':0.006535948,'21:30:00':0,'21:40:00':0.006535948,'21:50:00':0.006535948}
visit[5] = {'05:30:00':0,'05:40:00':0,'05:50:00':0,'06:00:00':0,'06:10:00':0,'06:20:00':0,'06:30:00':0.007246377,'06:40:00':0,'06:50:00':0.02173913,'07:00:00':0.115942029,'07:10:00':0.144927536,'07:20:00':0.282608696,'07:30:00':0.550724638,'07:40:00':0.514440621,'07:50:00':0.601449275,'08:00:00':0.702898551,'08:10:00':0.739130435,'08:20:00':0.768115942,'08:30:00':0.782504431,'08:40:00':0.652173913,'08:50:00':0.753623188,'09:00:00':0.702898551,'09:10:00':0.717391304,'09:20:00':0.427536232,'09:30:00':0.485507246,'09:40:00':0.253623188,'09:50:00':0.180846627,'10:00:00':0.180950891,'10:10:00':0.112790223,'10:20:00':0.531245706,'10:30:00':1.65402485,'10:40:00':6.147757292,'10:50:00':31.91170314,'11:00:00':100.7875535,'11:10:00':134.3962871,'11:20:00':145.3710488,'11:30:00':142.1208985,'11:40:00':127.7059558,'11:50:00':92.46111863,'12:00:00':56.55814739,'12:10:00':27.19429138,'12:20:00':14.03384842,'12:30:00':7.207703484,'12:40:00':4.425076274,'12:50:00':1.891252216,'13:00:00':1.355072464,'13:10:00':0.528985507,'13:20:00':0.413043478,'13:30:00':0.456521739,'13:40:00':0.304347826,'13:50:00':0.311594203,'14:00:00':0.137681159,'14:10:00':0.130434783,'14:20:00':0.065217391,'14:30:00':0.079710145,'14:40:00':0.072463768,'14:50:00':0.050724638,'15:00:00':0.02173913,'15:10:00':0.094202899,'15:20:00':0.036231884,'15:30:00':0.072463768,'15:40:00':0.057971014,'15:50:00':0.173913043,'16:00:00':0.333333333,'16:10:00':0.958938335,'16:20:00':15.0071806,'16:30:00':10.48051863,'16:40:00':21.86907264,'16:50:00':71.52189553,'17:00:00':135.4833382,'17:10:00':146.4000119,'17:20:00':130.4260312,'17:30:00':100.7393667,'17:40:00':59.76058747,'17:50:00':32.32558561,'18:00:00':15.75786587,'18:10:00':8.336738492,'18:20:00':4.038046767,'18:30:00':1.862266708,'18:40:00':0.949275362,'18:50:00':0.775362319,'19:00:00':0.420289855,'19:10:00':0.413043478,'19:20:00':0.268115942,'19:30:00':0.304347826,'19:40:00':0.246376812,'19:50:00':0.282608696,'20:00:00':0.239130435,'20:10:00':0.137681159,'20:20:00':0.173913043,'20:30:00':0.072463768,'20:40:00':0.057971014,'20:50:00':0.057971014,'21:00:00':0.02173913,'21:10:00':0.028985507,'21:20:00':0,'21:30:00':0.036231884,'21:40:00':0.014492754,'21:50:00':0.02173913}
visit[6] = {'05:30:00':0,'05:40:00':0,'05:50:00':0,'06:00:00':0,'06:10:00':0,'06:20:00':0,'06:30:00':0,'06:40:00':0,'06:50:00':0,'07:00:00':0,'07:10:00':0,'07:20:00':0,'07:30:00':0,'07:40:00':0,'07:50:00':0,'08:00:00':0,'08:10:00':0,'08:20:00':0,'08:30:00':0,'08:40:00':0,'08:50:00':0,'09:00:00':0.007407407,'09:10:00':0.007407407,'09:20:00':0,'09:30:00':0,'09:40:00':0,'09:50:00':0,'10:00:00':0,'10:10:00':0.007407407,'10:20:00':0.051851852,'10:30:00':0.762962963,'10:40:00':6.722222222,'10:50:00':36.45469577,'11:00:00':60.58373016,'11:10:00':71.90231481,'11:20:00':73.47255291,'11:30:00':68.8505291,'11:40:00':60.20039683,'11:50:00':44.86984127,'12:00:00':29.54212963,'12:10:00':16.11203704,'12:20:00':6.138558201,'12:30:00':1.911904762,'12:40:00':0.133333333,'12:50:00':0.007407407,'13:00:00':0.007407407,'13:10:00':0,'13:20:00':0,'13:30:00':0.007407407,'13:40:00':0,'13:50:00':0,'14:00:00':0,'14:10:00':0,'14:20:00':0,'14:30:00':0,'14:40:00':1.529034392,'14:50:00':2.386640212,'15:00:00':4.175330688,'15:10:00':0,'15:20:00':0,'15:30:00':0,'15:40:00':0.014814815,'15:50:00':0,'16:00:00':0,'16:10:00':0.041600529,'16:20:00':0.539616402,'16:30:00':2.781481481,'16:40:00':10.93174603,'16:50:00':44.12486772,'17:00:00':70.00125661,'17:10:00':74.35734127,'17:20:00':61.24298942,'17:30:00':44.23148148,'17:40:00':27.46130952,'17:50:00':19.71964286,'18:00:00':10.58267196,'18:10:00':2.661838624,'18:20:00':0.700859788,'18:30:00':0.044444444,'18:40:00':0.075595238,'18:50:00':0,'19:00:00':0,'19:10:00':0.060780423,'19:20:00':0,'19:30:00':0}
START_POINT = datetime(100,1,1,5,30,0)
FINISH_POINT = datetime(100,1,1,22,30,0)

INTERVAL = 10
for i in range(1,7):
	start = START_POINT
	end = START_POINT+ timedelta(seconds=INTERVAL*60)
	visit_i = visit[i]
	count_of_people = deepcopy(visit_i)

	while end <= FINISH_POINT:
		start_key = start.time().isoformat()
		idle_min = idletimes.get(start_key,15)
		
		for t in [0,5,10,15,20,25,30,35,40,45,50,55]:
			check_time_string = (start+timedelta(seconds=t*60)).time().isoformat()
			if check_time_string not in visit_i.keys():
				continue
			if idle_min>=t:
				count_of_people[check_time_string]+=visit_i[start_key]
			else:
				count_of_people[check_time_string]+=visit_i[start_key]*0.1
				check_time_string2 = (start-timedelta(seconds=t*60)).time().isoformat()
				if check_time_string2 in visit_i.keys():
					count_of_people[check_time_string2]-=visit_i[start_key]*0.1
				break
		start = end
		end += timedelta(seconds=INTERVAL*60)
	# print(count_of_people)
	fw = open("../../gen/flow/count_of_people_%dcan.csv"%i,"w")
	start = START_POINT
	end = START_POINT+ timedelta(seconds=INTERVAL*60)
	while end <= FINISH_POINT:
		start_key = start.time().isoformat()
		fw.write("%s,%d\n"%(start_key,count_of_people.get(start_key,0)))
		
		start = end
		end += timedelta(seconds=INTERVAL*60)
	fw.close()
# # fw.write("1-151,alpha,sigma\n")
# for shop in freqs:
# 	shopcode = str(shop[0])
# 	line = shopcode+","+account_name.get(shopcode,"")
	
# 	total_people = sum(shop[2:])
# 	for q in shop[2:]:
# 		line+=","
# 		if q<=0:
# 			continue
# 		else:
# 			line+=str((total_people*1.0/q)**0.66)
# 	line+="\n"		
# 	fw.write(line) 
# fw.close()